// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: org.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const addOrgMember = `-- name: AddOrgMember :exec
INSERT INTO organization_members (organization_id, user_id, role)
VALUES ($1, $2, $3)
`

type AddOrgMemberParams struct {
	OrganizationID int64            `json:"organizationId"`
	UserID         int64            `json:"userId"`
	Role           OrganizationRole `json:"role"`
}

func (q *Queries) AddOrgMember(ctx context.Context, arg AddOrgMemberParams) error {
	_, err := q.db.Exec(ctx, addOrgMember, arg.OrganizationID, arg.UserID, arg.Role)
	return err
}

const countOrgsForUser = `-- name: CountOrgsForUser :one
SELECT COUNT(*) FROM organization_members WHERE user_id = $1
`

func (q *Queries) CountOrgsForUser(ctx context.Context, userID int64) (int64, error) {
	row := q.db.QueryRow(ctx, countOrgsForUser, userID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const createOrg = `-- name: CreateOrg :one
INSERT INTO organizations (name, created_by)
VALUES ($1, $2)
RETURNING id, name, created_by, created_at, updated_at
`

type CreateOrgParams struct {
	Name      string `json:"name"`
	CreatedBy int64  `json:"createdBy"`
}

func (q *Queries) CreateOrg(ctx context.Context, arg CreateOrgParams) (Organization, error) {
	row := q.db.QueryRow(ctx, createOrg, arg.Name, arg.CreatedBy)
	var i Organization
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.CreatedBy,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const deleteEmptyWorkspacesForOrg = `-- name: DeleteEmptyWorkspacesForOrg :exec
DELETE FROM workspaces
WHERE org_id = $1
AND NOT EXISTS (
  SELECT 1 FROM apps WHERE workspace_id = workspaces.id
)
`

func (q *Queries) DeleteEmptyWorkspacesForOrg(ctx context.Context, orgID int64) error {
	_, err := q.db.Exec(ctx, deleteEmptyWorkspacesForOrg, orgID)
	return err
}

const deleteOrg = `-- name: DeleteOrg :exec
DELETE FROM organizations WHERE id = $1
`

func (q *Queries) DeleteOrg(ctx context.Context, id int64) error {
	_, err := q.db.Exec(ctx, deleteOrg, id)
	return err
}

const getOrgByID = `-- name: GetOrgByID :one
SELECT id, name, created_by, created_at, updated_at FROM organizations WHERE id = $1
`

func (q *Queries) GetOrgByID(ctx context.Context, id int64) (Organization, error) {
	row := q.db.QueryRow(ctx, getOrgByID, id)
	var i Organization
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.CreatedBy,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getOrgByName = `-- name: GetOrgByName :one
SELECT id, name, created_by, created_at, updated_at FROM organizations WHERE name = $1
`

func (q *Queries) GetOrgByName(ctx context.Context, name string) (Organization, error) {
	row := q.db.QueryRow(ctx, getOrgByName, name)
	var i Organization
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.CreatedBy,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getOrgMemberRole = `-- name: GetOrgMemberRole :one
SELECT role FROM organization_members
WHERE organization_id = $1 AND user_id = $2
`

type GetOrgMemberRoleParams struct {
	OrganizationID int64 `json:"organizationId"`
	UserID         int64 `json:"userId"`
}

func (q *Queries) GetOrgMemberRole(ctx context.Context, arg GetOrgMemberRoleParams) (OrganizationRole, error) {
	row := q.db.QueryRow(ctx, getOrgMemberRole, arg.OrganizationID, arg.UserID)
	var role OrganizationRole
	err := row.Scan(&role)
	return role, err
}

const isOrgMember = `-- name: IsOrgMember :one
SELECT EXISTS(
  SELECT 1 FROM organization_members
  WHERE organization_id = $1 AND user_id = $2
) as is_member
`

type IsOrgMemberParams struct {
	OrganizationID int64 `json:"organizationId"`
	UserID         int64 `json:"userId"`
}

func (q *Queries) IsOrgMember(ctx context.Context, arg IsOrgMemberParams) (bool, error) {
	row := q.db.QueryRow(ctx, isOrgMember, arg.OrganizationID, arg.UserID)
	var is_member bool
	err := row.Scan(&is_member)
	return is_member, err
}

const isOrgNameUnique = `-- name: IsOrgNameUnique :one
SELECT COUNT(*) = 0 as is_unique
FROM organizations
WHERE name = $1
`

func (q *Queries) IsOrgNameUnique(ctx context.Context, name string) (bool, error) {
	row := q.db.QueryRow(ctx, isOrgNameUnique, name)
	var is_unique bool
	err := row.Scan(&is_unique)
	return is_unique, err
}

const listOrgsForUser = `-- name: ListOrgsForUser :many
SELECT DISTINCT o.id, o.name, o.created_by, o.created_at, o.updated_at
FROM organizations o
JOIN organization_members om ON om.organization_id = o.id
WHERE om.user_id = $1
ORDER BY o.created_at DESC
OFFSET $2
LIMIT $3
`

type ListOrgsForUserParams struct {
	UserID int64 `json:"userId"`
	Offset int32 `json:"offset"`
	Limit  int32 `json:"limit"`
}

func (q *Queries) ListOrgsForUser(ctx context.Context, arg ListOrgsForUserParams) ([]Organization, error) {
	rows, err := q.db.Query(ctx, listOrgsForUser, arg.UserID, arg.Offset, arg.Limit)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Organization
	for rows.Next() {
		var i Organization
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.CreatedBy,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listWorkspacesForOrg = `-- name: ListWorkspacesForOrg :many
SELECT id, name, created_by, created_at
FROM workspaces
WHERE org_id = $1
ORDER BY created_at DESC
`

type ListWorkspacesForOrgRow struct {
	ID        int64              `json:"id"`
	Name      string             `json:"name"`
	CreatedBy int64              `json:"createdBy"`
	CreatedAt pgtype.Timestamptz `json:"createdAt"`
}

func (q *Queries) ListWorkspacesForOrg(ctx context.Context, orgID int64) ([]ListWorkspacesForOrgRow, error) {
	rows, err := q.db.Query(ctx, listWorkspacesForOrg, orgID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListWorkspacesForOrgRow
	for rows.Next() {
		var i ListWorkspacesForOrgRow
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.CreatedBy,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const orgHasWorkspacesWithApps = `-- name: OrgHasWorkspacesWithApps :one
SELECT EXISTS(
  SELECT 1 FROM workspaces w
  WHERE w.org_id = $1
  AND EXISTS(
    SELECT 1 FROM apps a WHERE a.workspace_id = w.id
  )
) as has_apps_in_workspaces
`

func (q *Queries) OrgHasWorkspacesWithApps(ctx context.Context, orgID int64) (bool, error) {
	row := q.db.QueryRow(ctx, orgHasWorkspacesWithApps, orgID)
	var has_apps_in_workspaces bool
	err := row.Scan(&has_apps_in_workspaces)
	return has_apps_in_workspaces, err
}

const updateOrgName = `-- name: UpdateOrgName :one
UPDATE organizations
SET name = $2, updated_at = NOW()
WHERE id = $1
RETURNING id, name, created_by, created_at, updated_at
`

type UpdateOrgNameParams struct {
	ID   int64  `json:"id"`
	Name string `json:"name"`
}

func (q *Queries) UpdateOrgName(ctx context.Context, arg UpdateOrgNameParams) (Organization, error) {
	row := q.db.QueryRow(ctx, updateOrgName, arg.ID, arg.Name)
	var i Organization
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.CreatedBy,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}
