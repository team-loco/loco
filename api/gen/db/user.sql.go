// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: user.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const addOrganizationMember = `-- name: AddOrganizationMember :one

INSERT INTO organization_members (organization_id, user_id)
VALUES ($1, $2)
RETURNING organization_id, user_id
`

type AddOrganizationMemberParams struct {
	OrganizationID int64 `json:"organizationId"`
	UserID         int64 `json:"userId"`
}

type AddOrganizationMemberRow struct {
	OrganizationID int64 `json:"organizationId"`
	UserID         int64 `json:"userId"`
}

// Organization members queries
func (q *Queries) AddOrganizationMember(ctx context.Context, arg AddOrganizationMemberParams) (AddOrganizationMemberRow, error) {
	row := q.db.QueryRow(ctx, addOrganizationMember, arg.OrganizationID, arg.UserID)
	var i AddOrganizationMemberRow
	err := row.Scan(&i.OrganizationID, &i.UserID)
	return i, err
}

const addWorkspaceMember = `-- name: AddWorkspaceMember :one

INSERT INTO workspace_members (workspace_id, user_id)
VALUES ($1, $2)
RETURNING workspace_id, user_id
`

type AddWorkspaceMemberParams struct {
	WorkspaceID int64 `json:"workspaceId"`
	UserID      int64 `json:"userId"`
}

type AddWorkspaceMemberRow struct {
	WorkspaceID int64 `json:"workspaceId"`
	UserID      int64 `json:"userId"`
}

// Workspace members queries
func (q *Queries) AddWorkspaceMember(ctx context.Context, arg AddWorkspaceMemberParams) (AddWorkspaceMemberRow, error) {
	row := q.db.QueryRow(ctx, addWorkspaceMember, arg.WorkspaceID, arg.UserID)
	var i AddWorkspaceMemberRow
	err := row.Scan(&i.WorkspaceID, &i.UserID)
	return i, err
}

const checkUserHasOrganizations = `-- name: CheckUserHasOrganizations :one
SELECT EXISTS(SELECT 1 FROM organizations WHERE created_by = $1) AS has_orgs
`

func (q *Queries) CheckUserHasOrganizations(ctx context.Context, createdBy int64) (bool, error) {
	row := q.db.QueryRow(ctx, checkUserHasOrganizations, createdBy)
	var has_orgs bool
	err := row.Scan(&has_orgs)
	return has_orgs, err
}

const checkUserHasWorkspaces = `-- name: CheckUserHasWorkspaces :one
SELECT EXISTS(
  SELECT 1 FROM workspace_members
  WHERE user_id = $1
) AS has_workspaces
`

func (q *Queries) CheckUserHasWorkspaces(ctx context.Context, userID int64) (bool, error) {
	row := q.db.QueryRow(ctx, checkUserHasWorkspaces, userID)
	var has_workspaces bool
	err := row.Scan(&has_workspaces)
	return has_workspaces, err
}

const countUsers = `-- name: CountUsers :one
SELECT COUNT(*) FROM users
`

func (q *Queries) CountUsers(ctx context.Context) (int64, error) {
	row := q.db.QueryRow(ctx, countUsers)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const createOrganization = `-- name: CreateOrganization :one

INSERT INTO organizations (name, created_by)
VALUES ($1, $2)
RETURNING id, name, created_by, created_at, updated_at
`

type CreateOrganizationParams struct {
	Name      string `json:"name"`
	CreatedBy int64  `json:"createdBy"`
}

// Organization queries
func (q *Queries) CreateOrganization(ctx context.Context, arg CreateOrganizationParams) (Organization, error) {
	row := q.db.QueryRow(ctx, createOrganization, arg.Name, arg.CreatedBy)
	var i Organization
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.CreatedBy,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const createUser = `-- name: CreateUser :one

INSERT INTO users (external_id, email, name, avatar_url)
VALUES ($1, $2, $3, $4)
RETURNING id, external_id, email, name, avatar_url, created_at, updated_at
`

type CreateUserParams struct {
	ExternalID string      `json:"externalId"`
	Email      string      `json:"email"`
	Name       pgtype.Text `json:"name"`
	AvatarUrl  pgtype.Text `json:"avatarUrl"`
}

// User queries for sqlc
func (q *Queries) CreateUser(ctx context.Context, arg CreateUserParams) (User, error) {
	row := q.db.QueryRow(ctx, createUser,
		arg.ExternalID,
		arg.Email,
		arg.Name,
		arg.AvatarUrl,
	)
	var i User
	err := row.Scan(
		&i.ID,
		&i.ExternalID,
		&i.Email,
		&i.Name,
		&i.AvatarUrl,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const createWorkspace = `-- name: CreateWorkspace :one

INSERT INTO workspaces (org_id, name, description, created_by)
VALUES ($1, $2, $3, $4)
RETURNING id, org_id, name, description, created_by, created_at, updated_at
`

type CreateWorkspaceParams struct {
	OrgID       int64       `json:"orgId"`
	Name        string      `json:"name"`
	Description pgtype.Text `json:"description"`
	CreatedBy   int64       `json:"createdBy"`
}

// Workspace queries
func (q *Queries) CreateWorkspace(ctx context.Context, arg CreateWorkspaceParams) (Workspace, error) {
	row := q.db.QueryRow(ctx, createWorkspace,
		arg.OrgID,
		arg.Name,
		arg.Description,
		arg.CreatedBy,
	)
	var i Workspace
	err := row.Scan(
		&i.ID,
		&i.OrgID,
		&i.Name,
		&i.Description,
		&i.CreatedBy,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const deleteOrganization = `-- name: DeleteOrganization :exec
DELETE FROM organizations WHERE id = $1
`

func (q *Queries) DeleteOrganization(ctx context.Context, id int64) error {
	_, err := q.db.Exec(ctx, deleteOrganization, id)
	return err
}

const deleteUser = `-- name: DeleteUser :exec
DELETE FROM users WHERE id = $1
`

func (q *Queries) DeleteUser(ctx context.Context, id int64) error {
	_, err := q.db.Exec(ctx, deleteUser, id)
	return err
}

const deleteWorkspace = `-- name: DeleteWorkspace :exec
DELETE FROM workspaces WHERE id = $1
`

func (q *Queries) DeleteWorkspace(ctx context.Context, id int64) error {
	_, err := q.db.Exec(ctx, deleteWorkspace, id)
	return err
}

const getOrganizationByID = `-- name: GetOrganizationByID :one
SELECT id, name, created_by, created_at, updated_at
FROM organizations
WHERE id = $1
`

func (q *Queries) GetOrganizationByID(ctx context.Context, id int64) (Organization, error) {
	row := q.db.QueryRow(ctx, getOrganizationByID, id)
	var i Organization
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.CreatedBy,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getOrganizationByName = `-- name: GetOrganizationByName :one
SELECT id, name, created_by, created_at, updated_at
FROM organizations
WHERE name = $1
`

func (q *Queries) GetOrganizationByName(ctx context.Context, name string) (Organization, error) {
	row := q.db.QueryRow(ctx, getOrganizationByName, name)
	var i Organization
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.CreatedBy,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getOrganizationMember = `-- name: GetOrganizationMember :one
SELECT organization_id, user_id
FROM organization_members
WHERE organization_id = $1 AND user_id = $2
`

type GetOrganizationMemberParams struct {
	OrganizationID int64 `json:"organizationId"`
	UserID         int64 `json:"userId"`
}

type GetOrganizationMemberRow struct {
	OrganizationID int64 `json:"organizationId"`
	UserID         int64 `json:"userId"`
}

func (q *Queries) GetOrganizationMember(ctx context.Context, arg GetOrganizationMemberParams) (GetOrganizationMemberRow, error) {
	row := q.db.QueryRow(ctx, getOrganizationMember, arg.OrganizationID, arg.UserID)
	var i GetOrganizationMemberRow
	err := row.Scan(&i.OrganizationID, &i.UserID)
	return i, err
}

const getUserByEmail = `-- name: GetUserByEmail :one
SELECT id, external_id, email, name, avatar_url, created_at, updated_at
FROM users
WHERE email = $1
`

func (q *Queries) GetUserByEmail(ctx context.Context, email string) (User, error) {
	row := q.db.QueryRow(ctx, getUserByEmail, email)
	var i User
	err := row.Scan(
		&i.ID,
		&i.ExternalID,
		&i.Email,
		&i.Name,
		&i.AvatarUrl,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getUserByExternalID = `-- name: GetUserByExternalID :one
SELECT id, external_id, email, name, avatar_url, created_at, updated_at
FROM users
WHERE external_id = $1
`

func (q *Queries) GetUserByExternalID(ctx context.Context, externalID string) (User, error) {
	row := q.db.QueryRow(ctx, getUserByExternalID, externalID)
	var i User
	err := row.Scan(
		&i.ID,
		&i.ExternalID,
		&i.Email,
		&i.Name,
		&i.AvatarUrl,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getUserByID = `-- name: GetUserByID :one
SELECT id, external_id, email, name, avatar_url, created_at, updated_at
FROM users
WHERE id = $1
`

func (q *Queries) GetUserByID(ctx context.Context, id int64) (User, error) {
	row := q.db.QueryRow(ctx, getUserByID, id)
	var i User
	err := row.Scan(
		&i.ID,
		&i.ExternalID,
		&i.Email,
		&i.Name,
		&i.AvatarUrl,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getWorkspaceByID = `-- name: GetWorkspaceByID :one
SELECT id, org_id, name, description, created_by, created_at, updated_at
FROM workspaces
WHERE id = $1
`

func (q *Queries) GetWorkspaceByID(ctx context.Context, id int64) (Workspace, error) {
	row := q.db.QueryRow(ctx, getWorkspaceByID, id)
	var i Workspace
	err := row.Scan(
		&i.ID,
		&i.OrgID,
		&i.Name,
		&i.Description,
		&i.CreatedBy,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getWorkspaceMember = `-- name: GetWorkspaceMember :one
SELECT workspace_id, user_id
FROM workspace_members
WHERE workspace_id = $1 AND user_id = $2
`

type GetWorkspaceMemberParams struct {
	WorkspaceID int64 `json:"workspaceId"`
	UserID      int64 `json:"userId"`
}

type GetWorkspaceMemberRow struct {
	WorkspaceID int64 `json:"workspaceId"`
	UserID      int64 `json:"userId"`
}

func (q *Queries) GetWorkspaceMember(ctx context.Context, arg GetWorkspaceMemberParams) (GetWorkspaceMemberRow, error) {
	row := q.db.QueryRow(ctx, getWorkspaceMember, arg.WorkspaceID, arg.UserID)
	var i GetWorkspaceMemberRow
	err := row.Scan(&i.WorkspaceID, &i.UserID)
	return i, err
}

const isOrganizationNameUnique = `-- name: IsOrganizationNameUnique :one
SELECT COUNT(*) = 0 AS is_unique
FROM organizations
WHERE name = $1
`

func (q *Queries) IsOrganizationNameUnique(ctx context.Context, name string) (bool, error) {
	row := q.db.QueryRow(ctx, isOrganizationNameUnique, name)
	var is_unique bool
	err := row.Scan(&is_unique)
	return is_unique, err
}

const listOrganizationMembers = `-- name: ListOrganizationMembers :many
SELECT organization_id, user_id
FROM organization_members
WHERE organization_id = $1
ORDER BY created_at DESC
`

type ListOrganizationMembersRow struct {
	OrganizationID int64 `json:"organizationId"`
	UserID         int64 `json:"userId"`
}

func (q *Queries) ListOrganizationMembers(ctx context.Context, organizationID int64) ([]ListOrganizationMembersRow, error) {
	rows, err := q.db.Query(ctx, listOrganizationMembers, organizationID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListOrganizationMembersRow
	for rows.Next() {
		var i ListOrganizationMembersRow
		if err := rows.Scan(&i.OrganizationID, &i.UserID); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listUserOrganizations = `-- name: ListUserOrganizations :many
SELECT DISTINCT o.id, o.name, o.created_by, o.created_at, o.updated_at
FROM organizations o
JOIN organization_members om ON om.organization_id = o.id
WHERE om.user_id = $1
ORDER BY o.created_at DESC
`

func (q *Queries) ListUserOrganizations(ctx context.Context, userID int64) ([]Organization, error) {
	rows, err := q.db.Query(ctx, listUserOrganizations, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Organization
	for rows.Next() {
		var i Organization
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.CreatedBy,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listUserWorkspaces = `-- name: ListUserWorkspaces :many
SELECT DISTINCT w.id, w.org_id, w.name, w.description, w.created_by, w.created_at, w.updated_at
FROM workspaces w
JOIN workspace_members wm ON wm.workspace_id = w.id
WHERE wm.user_id = $1
ORDER BY w.created_at DESC
`

func (q *Queries) ListUserWorkspaces(ctx context.Context, userID int64) ([]Workspace, error) {
	rows, err := q.db.Query(ctx, listUserWorkspaces, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Workspace
	for rows.Next() {
		var i Workspace
		if err := rows.Scan(
			&i.ID,
			&i.OrgID,
			&i.Name,
			&i.Description,
			&i.CreatedBy,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listUsers = `-- name: ListUsers :many
SELECT id, external_id, email, name, avatar_url, created_at, updated_at
FROM users
ORDER BY created_at DESC
LIMIT $1 OFFSET $2
`

type ListUsersParams struct {
	Limit  int32 `json:"limit"`
	Offset int32 `json:"offset"`
}

func (q *Queries) ListUsers(ctx context.Context, arg ListUsersParams) ([]User, error) {
	rows, err := q.db.Query(ctx, listUsers, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []User
	for rows.Next() {
		var i User
		if err := rows.Scan(
			&i.ID,
			&i.ExternalID,
			&i.Email,
			&i.Name,
			&i.AvatarUrl,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listWorkspaceMembers = `-- name: ListWorkspaceMembers :many
SELECT workspace_id, user_id
FROM workspace_members
WHERE workspace_id = $1
ORDER BY created_at DESC
`

type ListWorkspaceMembersRow struct {
	WorkspaceID int64 `json:"workspaceId"`
	UserID      int64 `json:"userId"`
}

func (q *Queries) ListWorkspaceMembers(ctx context.Context, workspaceID int64) ([]ListWorkspaceMembersRow, error) {
	rows, err := q.db.Query(ctx, listWorkspaceMembers, workspaceID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListWorkspaceMembersRow
	for rows.Next() {
		var i ListWorkspaceMembersRow
		if err := rows.Scan(&i.WorkspaceID, &i.UserID); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const removeOrganizationMember = `-- name: RemoveOrganizationMember :exec
DELETE FROM organization_members
WHERE organization_id = $1 AND user_id = $2
`

type RemoveOrganizationMemberParams struct {
	OrganizationID int64 `json:"organizationId"`
	UserID         int64 `json:"userId"`
}

func (q *Queries) RemoveOrganizationMember(ctx context.Context, arg RemoveOrganizationMemberParams) error {
	_, err := q.db.Exec(ctx, removeOrganizationMember, arg.OrganizationID, arg.UserID)
	return err
}

const removeWorkspaceMember = `-- name: RemoveWorkspaceMember :exec
DELETE FROM workspace_members
WHERE workspace_id = $1 AND user_id = $2
`

type RemoveWorkspaceMemberParams struct {
	WorkspaceID int64 `json:"workspaceId"`
	UserID      int64 `json:"userId"`
}

func (q *Queries) RemoveWorkspaceMember(ctx context.Context, arg RemoveWorkspaceMemberParams) error {
	_, err := q.db.Exec(ctx, removeWorkspaceMember, arg.WorkspaceID, arg.UserID)
	return err
}

const updateUserAvatarURL = `-- name: UpdateUserAvatarURL :one
UPDATE users
SET avatar_url = $2, updated_at = NOW()
WHERE id = $1
RETURNING id, external_id, email, name, avatar_url, created_at, updated_at
`

type UpdateUserAvatarURLParams struct {
	ID        int64       `json:"id"`
	AvatarUrl pgtype.Text `json:"avatarUrl"`
}

func (q *Queries) UpdateUserAvatarURL(ctx context.Context, arg UpdateUserAvatarURLParams) (User, error) {
	row := q.db.QueryRow(ctx, updateUserAvatarURL, arg.ID, arg.AvatarUrl)
	var i User
	err := row.Scan(
		&i.ID,
		&i.ExternalID,
		&i.Email,
		&i.Name,
		&i.AvatarUrl,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}
