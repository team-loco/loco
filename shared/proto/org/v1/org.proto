syntax = "proto3";

package org.v1;

import "google/protobuf/field_mask.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/team-loco/loco/shared/proto/org/v1;orgv1";

// OrgService manages organizations.
service OrgService {
  // CreateOrg creates a new organization.
  rpc CreateOrg(CreateOrgRequest) returns (CreateOrgResponse);
  // GetOrg retrieves an organization by ID or name.
  rpc GetOrg(GetOrgRequest) returns (GetOrgResponse);
  // UpdateOrg updates organization information.
  rpc UpdateOrg(UpdateOrgRequest) returns (UpdateOrgResponse);
  // DeleteOrg deletes an organization.
  rpc DeleteOrg(DeleteOrgRequest) returns (DeleteOrgResponse);

  // ListUserOrgs lists organizations for a user.
  rpc ListUserOrgs(ListUserOrgsRequest) returns (ListUserOrgsResponse);
  // ListOrgUsers lists users in an organization.
  rpc ListOrgUsers(ListOrgUsersRequest) returns (ListOrgUsersResponse);
  // ListOrgWorkspaces lists workspaces in an organization.
  rpc ListOrgWorkspaces(ListOrgWorkspacesRequest) returns (ListOrgWorkspacesResponse);
}

// Organization represents a top-level organization container for users, workspaces, and resources.
message Organization {
  int64 id = 1;
  string name = 2;
  int64 created_by = 3;
  google.protobuf.Timestamp created_at = 4;
  google.protobuf.Timestamp updated_at = 5;
}

// WorkspaceSummary provides a lightweight summary of a workspace for listing operations.
message WorkspaceSummary {
  int64 id = 1;
  string name = 2;
  int64 created_by = 3;
  google.protobuf.Timestamp created_at = 4;
}

// CreateOrgRequest is the request to create a new organization.
message CreateOrgRequest {
  optional string name = 1;
}

// CreateOrgResponse is the response containing the created organization ID.
message CreateOrgResponse {
  int64 org_id = 1;
}

// GetOrgRequest is the request to retrieve an organization.
message GetOrgRequest {
  oneof key {
    int64 org_id = 1;
    string org_name = 2;
  }
}

// GetOrgResponse is the response containing the organization.
message GetOrgResponse {
  Organization organization = 1;
}

// ListUserOrgsRequest is the request to list organizations for a user.
message ListUserOrgsRequest {
  int64 user_id = 1;
  int32 page_size = 2; // default: 50, max: 200
  string page_token = 3; // cursor from previous page (base64-encoded timestamp+id)
}

// ListUserOrgsResponse is the response containing organization list.
message ListUserOrgsResponse {
  repeated Organization orgs = 1;
  string next_page_token = 2; // empty if no more pages
}

// ListOrgUsersRequest is the request to list users in an organization.
message ListOrgUsersRequest {
  int64 org_id = 1;
  int32 page_size = 2; // default: 50, max: 200
  string page_token = 3; // cursor from previous page (base64-encoded timestamp+id)
}

// ListOrgUsersResponse is the response containing user list.
message ListOrgUsersResponse {
  repeated User users = 1;
  string next_page_token = 2; // empty if no more pages
}

// User is a lightweight representation of a user for listing.
message User {
  int64 id = 1;
  string email = 2;
  string name = 3;
  string avatar_url = 4;
}

// ListOrgWorkspacesRequest is the request to list workspaces in an organization.
message ListOrgWorkspacesRequest {
  int64 org_id = 1;
  int32 page_size = 2; // default: 50, max: 200
  string page_token = 3; // cursor from previous page (base64-encoded timestamp+id)
}

// ListOrgWorkspacesResponse is the response containing workspace list.
message ListOrgWorkspacesResponse {
  repeated WorkspaceSummary workspaces = 1;
  string next_page_token = 2; // empty if no more pages
}

// UpdateOrgRequest is the request to update an organization.
message UpdateOrgRequest {
  int64 org_id = 1;
  google.protobuf.FieldMask update_mask = 2;
  optional string name = 3;
}

// UpdateOrgResponse is the response containing the updated organization ID.
message UpdateOrgResponse {
  int64 org_id = 1;
}

// DeleteOrgRequest is the request to delete an organization.
message DeleteOrgRequest {
  int64 org_id = 1;
}

// DeleteOrgResponse is the response after deleting an organization.
message DeleteOrgResponse {}
