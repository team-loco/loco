syntax = "proto3";

package loco.oauth.v1;

option go_package = "github.com/team-loco/loco/shared/proto/oauth/v1;oauthv1";

// OAuthProvider represents supported OAuth identity providers.
enum OAuthProvider {
  OAUTH_PROVIDER_UNSPECIFIED = 0;
  GITHUB                     = 1;
}

// GetOAuthDetailsRequest is the request to get OAuth configuration for a provider.
message GetOAuthDetailsRequest {
  OAuthProvider provider = 1;
}

// GetOAuthDetailsResponse contains OAuth configuration details needed for client-side OAuth flow.
message GetOAuthDetailsResponse {
  string client_id = 1;
  double token_ttl = 2;
}

// ExchangeOAuthTokenRequest exchanges an OAuth provider access token for a Loco authentication token.
message ExchangeOAuthTokenRequest {
  OAuthProvider provider                = 1;
  string        token                   = 2;
  bool          create_user_if_not_exists = 3;
}

// ExchangeOAuthTokenResponse contains the Loco token and user info from OAuth token exchange.
message ExchangeOAuthTokenResponse {
  string loco_token = 1;
  int64  expires_in = 2; // seconds
  int64  user_id    = 3;
  string name       = 4;
}

// GetOAuthAuthorizationURLRequest is the request to initiate OAuth authorization flow.
message GetOAuthAuthorizationURLRequest {
  OAuthProvider provider     = 1;
  string        state        = 2;
  string        redirect_uri = 3;
}

// GetOAuthAuthorizationURLResponse contains the OAuth authorization URL for client redirect.
message GetOAuthAuthorizationURLResponse {
  string authorization_url = 1;
  string state             = 2;
}

// ExchangeOAuthCodeRequest exchanges an OAuth authorization code for authentication tokens.
message ExchangeOAuthCodeRequest {
  OAuthProvider provider     = 1;
  string        code         = 2;
  string        state        = 3;
  string        redirect_uri = 4;
}

// ExchangeOAuthCodeResponse contains the Loco token and user info from OAuth code exchange.
message ExchangeOAuthCodeResponse {
  int64  expires_in = 1;
  int64  user_id    = 2;
  string name       = 3;
}

// OAuthService handles OAuth authentication flows.
service OAuthService {
  // GetOAuthDetails retrieves OAuth configuration for a provider.
  rpc GetOAuthDetails(GetOAuthDetailsRequest) returns (GetOAuthDetailsResponse) {}
  // ExchangeOAuthToken exchanges an OAuth provider token for a Loco token.
  rpc ExchangeOAuthToken(ExchangeOAuthTokenRequest) returns (ExchangeOAuthTokenResponse);
  // GetOAuthAuthorizationURL generates an OAuth authorization URL for a provider.
  rpc GetOAuthAuthorizationURL(GetOAuthAuthorizationURLRequest) returns (GetOAuthAuthorizationURLResponse) {}
  // ExchangeOAuthCode exchanges an OAuth authorization code for a Loco token.
  rpc ExchangeOAuthCode(ExchangeOAuthCodeRequest) returns (ExchangeOAuthCodeResponse) {}
}
