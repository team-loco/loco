syntax = "proto3";

package loco.oauth.v1;

option go_package = "github.com/team-loco/loco/shared/proto/oauth/v1;oauthv1";

// GithubOAuthDetailsRequest is the request to get GitHub OAuth configuration for client setup.
message GithubOAuthDetailsRequest {}

// GithubOAuthDetailsResponse contains GitHub OAuth configuration details needed for client-side OAuth flow.
message GithubOAuthDetailsResponse {
  string client_id = 1;
  double token_ttl = 2;
}

// ExchangeGithubTokenRequest exchanges a GitHub access token for a Loco authentication token.
message ExchangeGithubTokenRequest {
  string github_access_token = 1;
  bool create_user_if_not_exists = 2;
}

// ExchangeGithubTokenResponse contains the Loco token and user info from GitHub token exchange.
message ExchangeGithubTokenResponse {
  string loco_token = 1;
  int64 expires_in = 2; // seconds
  int64 user_id = 3;
  string name = 4;
}

// GetGithubAuthorizationURLRequest is the request to initiate GitHub OAuth authorization flow.
message GetGithubAuthorizationURLRequest {
  string state = 1;
  string redirect_uri = 2;
}

// GetGithubAuthorizationURLResponse contains the GitHub authorization URL for client redirect.
message GetGithubAuthorizationURLResponse {
  string authorization_url = 1;
  string state = 2;
}

// ExchangeGithubCodeRequest exchanges a GitHub authorization code for authentication tokens.
message ExchangeGithubCodeRequest {
  string code = 1;
  string state = 2;
  string redirect_uri = 3;
}

// ExchangeGithubCodeResponse contains the Loco token and user info from GitHub code exchange.
message ExchangeGithubCodeResponse {
  int64 expires_in = 1;
  int64 user_id = 2;
  string name = 3;
}

// OAuthService handles OAuth authentication flows.
service OAuthService {
  // GithubOAuthDetails retrieves GitHub OAuth configuration.
  rpc GithubOAuthDetails(GithubOAuthDetailsRequest) returns (GithubOAuthDetailsResponse) {}
  // ExchangeGithubToken exchanges a GitHub token for a Loco token.
  rpc ExchangeGithubToken(ExchangeGithubTokenRequest) returns (ExchangeGithubTokenResponse);
  // GetGithubAuthorizationURL generates a GitHub authorization URL.
  rpc GetGithubAuthorizationURL(GetGithubAuthorizationURLRequest) returns (GetGithubAuthorizationURLResponse) {}
  // ExchangeGithubCode exchanges a GitHub authorization code for a Loco token.
  rpc ExchangeGithubCode(ExchangeGithubCodeRequest) returns (ExchangeGithubCodeResponse) {}
}
